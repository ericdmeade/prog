/**
 *  This class is the main class of the "World of Zuul" application. 
 *  "World of Zuul" is a very simple, text based adventure game.  Users 
 *  can walk around some scenery. That's all. It should really be extended 
 *  to make it more interesting!
 * 
 *  To play this game, create an instance of this class and call the "play"
 *  method.
 * 
 *  This main class creates and initialises all the others: it creates all
 *  rooms, creates the parser and starts the game.  It also evaluates and
 *  executes the commands that the parser returns.
 * 
 * @author  Michael Kolling and David J. Barnes
 * @version 2011.07.31
 */

public class Game 
{
    private Parser parser;
    private Player player;
    private String prevRoom = "";
    private String currentRoom = "";
    
    private Room outside, reception, historyBlock, exhibition, artBlock, scienceBlock, gallery, giftshop, room_a, room_b;
        
    /**
     * Create the game and initialise its internal map.
     */
    public Game() 
    {                
        Room startRoom = createRooms();
        player = new Player("Eric", startRoom);        
        parser = new Parser();
    }

    /**
     * Create all the rooms and link their exits together.
     * 
     * @return Returns the starting room
     */
    private Room createRooms()
    {
      
        // create the rooms
        outside = new Room("outside the main entrance of the museum");
        reception = new Room("in a reception");
        historyBlock = new Room("in the museum historyBlock");
        exhibition = new Room("in the Eric D-Meade exhibition");
        artBlock = new Room("in the artBlock");
        scienceBlock = new Room("in the scienceBlock");
        gallery = new Room ("in the gallery");
        giftshop = new Room("in the giftshop");
        room_a = new Room("room a");
        room_b = new Room("room b");
        
        // put items in the room
        historyBlock.addItem(new Item("toy", "toy", 0.5));
        historyBlock.addItem(new Item("armour", "armour", 30));
        //historyBlock.addItem(new Item(" 
                                        
        exhibition.addItem(new Item("telescope", "telescope", 30));
        exhibition.addItem(new Item("skull", "skull", 0.5));
        
        reception.addItem(new Item("bell ", "bell", 0.3));
        reception.addItem(new Item("flyer", "flyer", 0.1));
  
        artBlock.addItem(new Item("paintbrush", "paintbrush", 0.2));
        artBlock.addItem(new Item("paint", "paint", 30));
        
        giftshop.addItem(new Item("keychain", "keychain", 0.2));
        giftshop.addItem(new Item("soya_milk","soya_milk", 0.5));
        giftshop.addItem(new Item("protein_shake","protein_shake", 0.5));  
        
        room_a.addItem(new Item("diamond", "giant diamond",0.5));
        room_b.addItem(new Item("handcuffs","handcuffs",100));
        
        outside.addItem(new Item("gum", "gum", 30));
        outside.addItem(new Item("bottle", "broken bottle", 30));
        outside.addItem(new Item("money","money", 0.5));
        
        //initialising Characters
        reception.addCharacter(new Character("", "receptionist: key to the vault is in the museum somewhere...", "", null));
        historyBlock.addCharacter(new Character("", "guard: you need a VIP pass to enter", "", null));
        exhibition.addCharacter(new Character("" , "curator: choose either the east or west", "", null));
        room_b.addCharacter(new Character("" , "guard: caught you", "", null));
        
        // create a key that will be used to lock the exit to the rooms
        Item key = new Item("key", "key to the vault", 0.01);
        scienceBlock.addItem(key);
        // create a vipPass that will be used to lock the historyBlock        
        Item vipPass = new Item("vipPass", "vipPass", 0.01);
        giftshop.addItem(vipPass);
        
        
//        //initialise room exits
          outside.setExit("north",new Exit(outside, "north", reception, "south",null, null));
          
          giftshop.setExit("east",new Exit(giftshop,"east", reception, "west", null, null));
          reception.setExit("west",new Exit(reception, "west", giftshop, "east", null, null));
          
          historyBlock.setExit("north",new Exit(historyBlock, "north", exhibition, "south", vipPass, null));
          historyBlock.setExit("south",new Exit(historyBlock, "south", reception, "north", vipPass, null));
          
          exhibition.setExit("south",new Exit(exhibition, "south", room_b, "west", null, null));
          exhibition.setExit("south",new Exit(exhibition, "south", historyBlock, "north", null, null));
          
          room_a.setExit("east",new Exit(room_a, "east", exhibition, "west", key, null));
          room_b.setExit("west",new Exit(room_b, "west", exhibition, "east", key, null));
          
          
          artBlock.setExit("west",new Exit(artBlock, "west", historyBlock, "east", null, null));                  
          scienceBlock.setExit("west",new Exit(scienceBlock, "west", artBlock, "east", null, null));

        return outside;
    }


   public void play() 
    {            
        printWelcome();

        // Enter the main command loop.  Here we repeatedly read commands and
        // execute them until the game is over.

        boolean finished = false;
        while (! finished) 
        {
            Command command = parser.getCommand();
            finished = processCommand(command);
            if(player.getCurrentRoom() == room_a) {
                printWin();
                finished = true;
            }
            if(player.getCurrentRoom() == room_b) {
                printLose();
                finished = true;
            }
        }
//        }
        System.out.println("Game over.");
    }

    /**
     * Print out the opening message for the player.
     */
    
    private void printWelcome()
    {
        System.out.println("Welcome to SoC World");
        System.out.println("You are a profesional thief, you've canvased Portsmouth's top Museum");
        System.out.println("and you know about the vault but don't know where it is.");
        System.out.println("to get into the vault you would need to get access to a key");
        System.out.println("you also have to be cautious of those who want to see you behind bars");
        System.out.println("Type 'help' if you need help.");
        System.out.println();
        System.out.println(player.getLongDescription());
    }
    
    private void printWin() 
    {
        System.out.println("\nYou got your reward and won the game. Congratulations!");
    }
    
    private void printLose() 
    {
        System.out.println("\nYou've walked in to the security office. caught red handed.");
    }
        
    
    /**
     * Given a command, process (that is: execute) the command.
     * If this command ends the game, true is returned, otherwise false is
     * returned.
     */
    private boolean processCommand(Command command) 
    {
        boolean wantToQuit = false;

        CommandWord commandWord = command.getCommandWord();

        switch (commandWord) 
        {
            case UNKNOWN:
                System.out.println("I don't know what you mean...");
                break;

            case HELP:
                printHelp();
                break;

            case MOVE:
                move(command);
                break;
                
            case TURN:
                turn(command);
                break;
                
            case TAKE:
               take(command);
               break;
               
            case DROP:
               drop(command);
               break;
            
            case DRINK:
               drink(command);
               break;
            
            case ITEMS:
               printItems();
               break;
               
//            case LOAD:
//               load(command);
//               break;
//        
//            case SAVE:
//               save(command);
//               break;
               
             case GIVE:
               give(command);
               break;
               
//            case BACK:
//               moveBack(command);
//               break;
               
            case QUIT:
                wantToQuit = quit(command);
                break;
        }
        return wantToQuit;
    }



    // implementations of user commands:

    /**
     * Print out some help information.
     * Here we print a message and a list of the 
     * command words.
     */
    private void printHelp() 
    {
        System.out.println("You are wander");
        System.out.println("around at the Museum.");
        System.out.println();
        System.out.println("Your command words are:");
        parser.showCommands();
    }


    /** 
     * Try to go to one direction. If there is an exit, enter the new
     * room, otherwise print an error message.
     */
    private void move(Command command) 
    {
        if(!command.hasSecondWord()) {
            // if there is no second word, we don't know where to go...
            System.out.println("Go where?");
            return;
        }

        String direction = command.getSecondWord();

        // Try to leave current room.
        Exit exit = player.getCurrentRoom().getExit(direction);

        if (exit == null) {
            System.out.println("There is no exit!");
        }
        else {
            if(player.move(direction)) {
                System.out.println(player.getLongDescription());
            } 
            else {
                System.out.println("The exit is locked and you need a key or a vipcard");
            }
        }
    }     

//private void moveBack(Command command)

//        prevRoom = currentRoom;
//        currentRoom = direction;
//        {
//        if(direction.equals("reception")){
//            prevRoom = "outside";
//            System.out.println("");
//        }else if(direction.equals("giftshop")){
//            prevRoom = "reception";
//            System.out.println("");
//        }
//        
//        if(direction.equals("historyBlock")){
//            prevRoom = "reception";
//            System.out.println("");
//        }else if(direction.equals("artBlock")){
//            prevRoom = "historyBlock";
//            System.out.println("");
//        }
//        
  
//        if(!direction.equals("scienceBlock") && !direction.equals("artBlock") && !direction.equals("historyBlock") ){
//            prevRoom = "outside";
//                
//            System.out.println("current: " +currentRoom);
//            System.out.println("previous: " +prevRoom);
//            System.out.println(player.getLongDescription());
//        }
//    
//       }
//        }   
//    }
     private void turn(Command command) // newly added
    {
       if(!command.hasSecondWord()) 
        {
            // if there is no second word, we don't know which way to turn...
            System.out.println("turn which way?");
         return;
         }

        String direction = command.getSecondWord();
        if(direction.equals("left")) 
        { player.turnLeft();
         }
        else if(direction.equals("right")) 
        { player.turnRight();
        }
        else 
        { System.out.println("You can not turn that way");}
        System.out.println("You are currently facing " + player.getDirection());
    }    
      
  
    /** 
     * "Quit" was entered. Check the rest of the command to see
     * whether we really quit the game. Return true, if this command
     * quits the game, false otherwise.
     */
    private boolean quit(Command command) 
    {
        if(command.hasSecondWord()) {
            System.out.println("Quit what?");
            return false;
        }
        else {
            return true;  // signal that we want to quit
        }
    }
    
    /** 
     * Try to take an item from the current room. If the item is there,
     * pick it up, if not print an error message.
//     */

    private void take(Command command) 
    {
        if(!command.hasSecondWord()) {
            // if there is no second word, we don't know what to take...
            System.out.println("What do you want to take?");
            return;
        }

        String itemName = command.getSecondWord();
        Item item = player.takeItem(itemName);
        
        if(item == null) {
            System.out.println("Can't pick up the item: " + itemName);
        } 
        else {
            System.out.println("Picked up " + item.getDescription());
        }
    }
    
    /** 
     * Drops an item into the current room. If the player carries the item
     * drop it, if not print an error message.
     */
    private void drop(Command command) 
    {
        if(!command.hasSecondWord()) {
            // if there is no second word, we don't know what to drop...
            System.out.println("What do you want to drop?");
            return;
        }

        String itemName = command.getSecondWord();
        Item item = player.dropItem(itemName);
        
        if(item == null) {
            System.out.println("You don't carry the item: " + itemName);
        } 
        else {
            System.out.println("Dropped " + item.getDescription());
        }
    }
    
    /**
     * Prints out the items that the player is currently carrying.
     */
    private void printItems() 
    {
        System.out.println(player.getItemsString());   
    }
        
     /** 
     * Try to take an item from the current room. If the item is there,
     * pick it up, if not print an error message.
     */
    /**
     * Eats the item if possible.
     */
    private void drink(Command command) 
    {
        if(!command.hasSecondWord()) {
            // if there is no second word, we don't know what to eat...
            System.out.println("what are you drinking?");
            return;
        }
        String itemName = command.getSecondWord();
       player.drink(itemName);
//        if(item == null) {
//            System.out.println("Can't drink " + itemName);            
//        } 
//        else {
//            System.out.println("drank " + item.getDescription());
        }
    

    private void give(Command command) 
    {
        if(!command.hasSecondWord()) {
            // if there is no second word, we don't know what to give...
            System.out.println("What do you want to give?");
            return;
        }
        String itemName = command.getSecondWord();
        Item item = player.give(itemName);
        
        
        if(item == null) {
            System.out.println("Could not give " + itemName);            
        } 
        else {
            System.out.println("Gave " + item.getDescription());
        }
        
                if(!command.hasSecondWord()) {
            // if there is no second word, we don't know where to go...
            System.out.println("Give what?");
            return;
        }

        String direction = command.getSecondWord();

//        // Try to leave current room.
//        Room nextRoom = player.getCurrentRoom().setExit(direction, exit);
//
//        if (nextRoom == null)
//            System.out.println("You can't give that!");
//        else {
//            player.enterRoom(nextRoom);
//            System.out.println(player.getLongDescription());
//        }
    }
    }



